<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>BookTrack | Data Peminjaman</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
    }
  </style>
</head>
<body class="bg-light">

<%- include('partials/navbar') %>

<div class="container mt-4">

  <div class="card shadow">
    <div class="card-body">
      <h5 class="mb-3">ðŸ“‹ Data Peminjaman Buku</h5>

      <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>Judul Buku</th>
            <th>Penulis</th>
            <th>Nama Peminjam</th>
            <th>Tanggal Pinjam</th>
            <th>Tanggal Kembali</th>
            <th>Status</th>
            <th class="text-center">Aksi</th>
          </tr>
        </thead>
        <tbody>
          <% if (peminjaman.length === 0) { %>
          <tr>
            <td colspan="7" class="text-center text-muted">Belum ada data peminjaman</td>
          </tr>
          <% } else { %>
            <% peminjaman.forEach(p => { %>
            <tr>
              <td><%= p.judul %></td>
              <td><%= p.penulis %></td>
              <td><%= p.nama_peminjam %></td>
              <td><%= new Date(p.tanggal_pinjam).toLocaleDateString('id-ID') %></td>
              <td>
                <% if (p.tanggal_kembali) { %>
                  <%= new Date(p.tanggal_kembali).toLocaleDateString('id-ID') %>
                <% } else { %>
                  <span class="text-muted">-</span>
                <% } %>
              </td>
              <td>
                <% if (p.tanggal_kembali) { %>
                  <span class="badge bg-success">Dikembalikan</span>
                <% } else { %>
                  <span class="badge bg-warning text-dark">dipinjam</span>
                <% } %>
              </td>
              <td class="text-center">
                <% if (!p.tanggal_kembali) { %>
                  <form action="/kembalikan/<%= p.id %>" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-success btn-sm"
                            onclick="return confirm('Kembalikan buku ini?')">
                      Kembalikan
                    </button>
                  </form>
                <% } else { %>
                  <form action="/peminjaman/delete/<%= p.id %>" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm"
                            onclick="return confirm('Hapus riwayat ini?')">
                      Hapus
                    </button>
                  </form>
                <% } %>
              </td>
            </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>

    </div>
  </div>

</div>

<%- include('partials/footer') %>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>